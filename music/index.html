<!DOCTYPE html>
<html>

<head>
  <meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1" />
  <title>Music</title>
  <link type="text/css" rel="stylesheet" href="music.css">
</head>

<body>
  <div class="container">
    <audio controls></audio>
    <div class="current-song"></div>
    <hr>
    <table class="song-list"></table>
  </div>

  <script type="text/javascript">
    window.app = {
      player: document.getElementsByTagName('audio')[0],
      songList: document.querySelector('.song-list'),

      addSongClickListener: function () {
        app.songList.addEventListener('click', function (e) {
          var btn = e.target;
          if (!btn.classList.contains('play-song')) { return; }

          var songId = parseInt(btn.getAttribute('data-id'));
          var song = app.songs.find(function (s) {
            return s.id === songId;
          });
          app.player.src = 'https://drive.google.com/uc?export=download&id=' + song.file_id;
          app.player.play();
          document.querySelector('.current-song').textContent = song.title;
        });
      },

      loadSongs: function () {
        fetch('https://jtunes.herokuapp.com/songs').then(function (response) {
          return response.json();
        }).then(function (songs) {
          app.songs = songs;
          app.renderSongs();
        });
      },

      renderSongs: function () {
        app.songs.forEach(function (song) {
          var row = document.createElement('tr');
          row.classList.add('song-row');
          row.innerHTML = '<td><img class="play-song" data-id="' + song.id + '" src="images/play.svg"></td><td>' + song.title + '</td><td>' + song.artist + '</td>';
          app.songList.appendChild(row);
        });
      }
    };

    app.addSongClickListener();
    app.loadSongs();
  </script>
</body>

</html>
